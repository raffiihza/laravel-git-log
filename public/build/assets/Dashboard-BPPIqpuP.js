import{u as G,r as l,j as e,H as T,L as m}from"./app-tqXt_TsF.js";import{d as D,l as F}from"./index-DPfDGp1o.js";/* empty css            */function $({repositories:p}){const{auth:f}=G().props,[r,k]=l.useState(null),[E,P]=l.useState(""),[g,b]=l.useState(!1),[j,w]=l.useState(!1),[y,o]=l.useState(""),[N,x]=l.useState(""),[i,L]=l.useState("simple"),[n,S]=l.useState(!1),d=async(t,a="simple",u=!1)=>{b(!0),o(""),x("");try{let s=`/api/git-log/${t.id}`;a==="detailed"?s=`/api/git-log/${t.id}/detailed`:a==="complete"&&(s=`/api/git-log/${t.id}/complete`),u&&(s+="?all_branches=true");const c=new AbortController,A=setTimeout(()=>c.abort(),15e3),h=await fetch(s,{signal:c.signal});clearTimeout(A);const v=await h.json();if(!h.ok)throw h.status===429?new Error("Rate limit exceeded. Please wait a moment before refreshing."):h.status===504?new Error("Request timed out. The repository might be too large or busy."):new Error(v.error||"Failed to fetch git log");P(v.git_log),k(t)}catch(s){s instanceof Error?s.name==="AbortError"?o("Request timed out. Please try again or select a different view mode."):o(s.message):o("An error occurred")}finally{b(!1)}},C=async()=>{if(r){w(!0),o(""),x("");try{const t=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");if(!t)throw new Error("CSRF token not found. Please refresh the page and try again.");const a=new AbortController,u=setTimeout(()=>a.abort(),7e4),s=await fetch(`/api/git-pull/${r.id}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t},signal:a.signal});clearTimeout(u);const c=await s.json();if(!s.ok)throw s.status===401?new Error("Please login to perform git pull."):s.status===429?new Error("Rate limit exceeded. Please wait before trying again."):s.status===504?new Error("Git pull timed out. The repository might be large or the network is slow."):new Error(c.error||"Failed to perform git pull");x(c.message||"Git pull completed successfully"),await d(r,i,n)}catch(t){t instanceof Error?t.name==="AbortError"?o("Git pull request timed out. Please try again."):o(t.message):o("An error occurred during git pull")}finally{w(!1)}}},R=()=>{r&&d(r,i,n)};return e.jsxs(e.Fragment,{children:[e.jsx(T,{title:"Git Log Dashboard"}),e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Git Log Dashboard"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"View git logs from your repositories"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(m,{href:"/frontend",className:"bg-purple-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-purple-700",children:"Frontend Projects"}),e.jsx(m,{href:"/project-logs",className:"bg-orange-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-orange-700",children:"Project Logs"}),f.user?e.jsxs(e.Fragment,{children:[e.jsx(m,{href:D(),className:"bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-blue-700",children:"Admin Dashboard"}),e.jsx(m,{href:"/repositories",className:"bg-green-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-green-700",children:"Manage Repositories"})]}):e.jsx(m,{href:F(),className:"bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-blue-700",children:"Admin Login"})]})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsx("div",{className:"bg-white shadow rounded-lg",children:e.jsxs("div",{className:"px-4 py-5 sm:p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Repositories"}),p.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"No repositories configured yet."}):e.jsx("div",{className:"space-y-2",children:p.map(t=>e.jsxs("div",{className:`p-3 border rounded-md cursor-pointer transition-colors ${r?.id===t.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>d(t,i,n),children:[e.jsx("h3",{className:"font-medium text-gray-900",children:t.name}),t.description&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:t.description}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:t.git_log_path})]},t.id))})]})})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsx("div",{className:"bg-white shadow rounded-lg",children:e.jsxs("div",{className:"px-4 py-5 sm:p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:r?`Git Log - ${r.name}`:"Select a Repository"}),r&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("select",{value:i,onChange:t=>{const a=t.target.value;L(a),d(r,a,n)},className:"text-sm border-gray-300 rounded-md bg-white text-gray-900 px-3 py-1 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"simple",children:"Graph View"}),e.jsx("option",{value:"detailed",children:"Detailed View"}),e.jsx("option",{value:"complete",children:"Complete View (All Commits)"})]}),e.jsxs("label",{className:"flex items-center space-x-2 text-sm text-gray-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n,onChange:t=>{const a=t.target.checked;S(a),d(r,i,a)},className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{children:"All Branches"})]}),e.jsx("button",{onClick:R,disabled:g,className:"bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 disabled:opacity-50",children:g?"Refreshing...":"Refresh"}),f.user&&e.jsx("button",{onClick:C,disabled:j||g,className:"bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700 disabled:opacity-50",title:"Pull latest changes from remote repository",children:j?"Pulling...":"Git Pull"})]})]}),N&&e.jsx("div",{className:"mb-4 p-3 bg-green-100 border border-green-400 text-green-700 rounded",children:N}),y&&e.jsx("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:y}),g?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):r?e.jsx("div",{className:"bg-gray-900 rounded-md p-4 overflow-x-auto",children:e.jsx("pre",{className:"text-green-400 text-sm whitespace-pre-wrap font-mono",children:E||"No git log data available"})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No repository selected"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Choose a repository to view its git log"})]})]})})})]})})]})]})}export{$ as default};
