import{u as z,r,j as e,H as E,L as f}from"./app-DEspCMgP.js";/* empty css            */function R({projectLogs:i}){const{auth:M}=z().props,[l,S]=r.useState(null),[h,p]=r.useState([]),[d,j]=r.useState(null),[n,y]=r.useState(null),[u,b]=r.useState(!1),[o,v]=r.useState(!1),[c,x]=r.useState(""),[m,N]=r.useState("");r.useEffect(()=>{i.length>0&&!l&&w(i[0])},[i]);const w=async s=>{S(s),j(null),y(null),N(""),await k(s.id)},k=async s=>{b(!0),x("");try{const t=await fetch(`/api/project-logs/${s}/files`),a=await t.json();if(!t.ok)throw new Error(a.error||"Gagal memuat daftar file");p(a.logFiles)}catch(t){x(t instanceof Error?t.message:"Terjadi kesalahan"),p([])}finally{b(!1)}},L=async s=>{if(l){v(!0),x(""),j(s);try{const t=await fetch(`/api/project-logs/${l.id}/content?file=${encodeURIComponent(s)}`),a=await t.json();if(!t.ok)throw new Error(a.error||"Gagal membaca file log");y(a)}catch(t){x(t instanceof Error?t.message:"Terjadi kesalahan")}finally{v(!1)}}},B=()=>{d&&L(d)},P=()=>{l&&k(l.id)},C=s=>{if(s===0)return"0 Bytes";const t=1024,a=["Bytes","KB","MB","GB"],F=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,F)).toFixed(2))+" "+a[F]},g=h.filter(s=>s.name.toLowerCase().includes(m.toLowerCase()));return e.jsxs(e.Fragment,{children:[e.jsx(E,{title:"Project Logs"}),e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Project Logs"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Lihat log dari berbagai project CI4"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(f,{href:"/",className:"text-gray-600 hover:text-gray-900 text-sm font-medium",children:"Git Log"}),e.jsx(f,{href:"/frontend",className:"text-gray-600 hover:text-gray-900 text-sm font-medium",children:"Frontend"}),M?.user&&e.jsx(f,{href:"/project-logs/manage",className:"bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-blue-700",children:"Kelola"})]})]})})}),i.length===0?e.jsx("div",{className:"max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Tidak ada project log"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Belum ada project log yang aktif."})]})}):e.jsxs("div",{className:"max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"bg-white shadow rounded-lg mb-6",children:e.jsx("div",{className:"px-4 py-4 sm:px-6",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("label",{htmlFor:"project-select",className:"text-sm font-medium text-gray-700",children:"Project:"}),e.jsx("select",{id:"project-select",value:l?.id||"",onChange:s=>{const t=i.find(a=>a.id===parseInt(s.target.value));t&&w(t)},className:"block w-64 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md bg-white text-gray-900",children:i.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))})]}),l?.description&&e.jsx("p",{className:"text-sm text-gray-500 flex-1 text-right",children:l.description})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white shadow rounded-lg sticky top-6",children:[e.jsxs("div",{className:"px-4 py-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h2",{className:"text-lg font-medium text-gray-900",children:["File Log",h.length>0&&e.jsxs("span",{className:"ml-2 text-sm font-normal text-gray-500",children:["(",g.length,"/",h.length,")"]})]}),e.jsx("button",{onClick:P,disabled:u,className:"p-1.5 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-md transition-colors disabled:opacity-50",title:"Refresh daftar file",children:e.jsx("svg",{className:`h-5 w-5 ${u?"animate-spin":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]}),e.jsx("input",{type:"text",placeholder:"Cari file log...",value:m,onChange:s=>N(s.target.value),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-900"})]}),e.jsx("div",{className:"p-2",children:u?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"})}):g.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:m?"Tidak ada file yang cocok.":"Tidak ada file log ditemukan."}):e.jsx("ul",{className:"divide-y divide-gray-100 max-h-[calc(100vh-350px)] overflow-y-auto",children:g.map((s,t)=>e.jsx("li",{children:e.jsx("button",{onClick:()=>L(s.name),className:`w-full text-left px-3 py-2.5 hover:bg-gray-50 rounded-md transition-colors ${d===s.name?"bg-blue-50 border-l-4 border-blue-500":""}`,children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center",children:[t===0&&!m&&e.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800 mr-2",children:"Terbaru"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:s.name})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:C(s.size)})]})})})},s.name))})})]})}),e.jsx("div",{className:"lg:col-span-3",children:e.jsxs("div",{className:"bg-white shadow rounded-lg",children:[e.jsx("div",{className:"px-4 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-medium text-gray-900",children:["Isi Log",n&&e.jsxs("span",{className:"ml-2 text-sm font-normal text-gray-500",children:["- ",n.filename]})]}),d&&e.jsxs("button",{onClick:B,disabled:o,className:"inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:[e.jsx("svg",{className:`h-4 w-4 mr-1.5 ${o?"animate-spin":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh"]})]})}),e.jsxs("div",{className:"p-4",children:[o&&e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-500",children:"Memuat..."})]}),c&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("svg",{className:"h-5 w-5 text-red-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),e.jsx("p",{className:"ml-3 text-sm text-red-700",children:c})]})}),!o&&!c&&!n&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Pilih file log dari daftar untuk melihat isinya"}),e.jsx("p",{className:"mt-1 text-xs text-gray-400",children:"Isi log akan ditampilkan dengan urutan terbalik (terbaru di atas)"})]}),!o&&!c&&n&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between text-sm text-gray-500",children:[e.jsxs("span",{children:["Ukuran: ",C(n.size)]}),e.jsxs("span",{children:["Terakhir diubah: ",n.modified]})]}),e.jsx("div",{className:"bg-gray-900 rounded-lg p-4 overflow-auto max-h-[calc(100vh-300px)]",children:e.jsx("pre",{className:"text-sm text-green-400 whitespace-pre-wrap break-words font-mono",children:n.content||"(File kosong)"})})]})]})]})})]})]})]})]})}export{R as default};
